
╭─── Claude Code v2.0.76 ──────────────────────────────────────────────────────╮
│                                                    │ Tips for getting        │
│                  Welcome back YC!                  │ started                 │
│                                                    │ Run /init to create a … │
│                    * ▗ ▗   ▖ ▖ *                   │ ─────────────────────── │
│                   *             *                  │ Recent activity         │
│                    *   ▘▘ ▝▝   *                   │ No recent activity      │
│                                                    │                         │
│ Sonnet 4.5 · Claude Pro · yc@gmail.com's │                         │
│  Organization                                      │                         │
│        ~/…/example_environments/03_mcp_demo        │                         │
╰──────────────────────────────────────────────────────────────────────────────╯

> Tell me how to configure a Cloudflare Worker script to cache JSON API 
responses for five minutes. use context7 

⏺ I'll help you find information about configuring Cloudflare Workers to cache JSON API responses. Let me use Context7 to get the latest documentation.

⏺ context7 - resolve-library-id (MCP)(query: "How to configure a Cloudflare
                                     Worker script to cache JSON API responses
                                     for five minutes", libraryName: "cloudflare
                                      workers")
  ⎿  Available Libraries:                                                  

     Each result includes:
     … +65 lines (ctrl+o to expand)

⏺ context7 - query-docs (MCP)(libraryId:
                             "/websites/developers_cloudflare_workers", query:
                             "How to cache JSON API responses for five minutes
                             using Cache API with custom cache TTL")
  ⎿ ### Implement Custom Caching in Fetch Handler for Cloudflare Workers   

    Source: https://github.com/context7/developers_cloudflare_workers/blob/
    … +456 lines (ctrl+o to expand)


⏺ Based on the Cloudflare Workers documentation, here are two approaches to cache JSON API responses for 5 minutes:

  Approach 1: Using Cache API (Recommended)

  export default {
    async fetch(request, env, ctx) {
      const cacheUrl = new URL(request.url);
      const cacheKey = new Request(cacheUrl.toString(), request);
      const cache = caches.default;

      // Check cache first
      let response = await cache.match(cacheKey);

      if (!response) {
        console.log(`Cache miss for: ${request.url}. Fetching from origin.`);

        // Fetch from origin
        response = await fetch(request);

        // Clone the response to make headers mutable
        response = new Response(response.body, response);

        // Set cache for 5 minutes (300 seconds)
        response.headers.append("Cache-Control", "s-maxage=300");

        // Store in cache
        ctx.waitUntil(cache.put(cacheKey, response.clone()));
      } else {
        console.log(`Cache hit for: ${request.url}`);
      }

      return response;
    },
  };

  Approach 2: Using fetch with cf.cacheTtl

  export default {
    async fetch(request) {
      const url = new URL(request.url);
      const cacheKey = `https://${url.hostname}${url.pathname}`;

      let response = await fetch(request, {
        cf: {
          // Cache for 5 minutes (300 seconds)
          cacheTtl: 300,
          cacheEverything: true,  // Cache all content types including JSON
          cacheKey: cacheKey,     // Enterprise-only feature
        },
      });

      // Make response headers mutable
      response = new Response(response.body, response);

      // Optional: Set browser cache headers
      response.headers.set("Cache-Control", "max-age=300");

      return response;
    },
  };

  Key Points

  - 5 minutes = 300 seconds for TTL values
  - Approach 1 (Cache API) works on all plans and respects Cache-Control headers
  - Approach 2 (cf.cacheTtl) is simpler but cacheKey is Enterprise-only
  - Use cacheEverything: true to ensure JSON responses are cached (by default, Cloudflare only caches certain file types)
  - s-maxage controls edge cache, max-age controls browser cache
